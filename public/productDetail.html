<html>
<head>
    <title>Product Detail</title>
</head>
<body>
    <h1>Product CRUD APP</h1>
    <input type="number" id="pid" placeholder="Product ID">
    <input type="text" id="ptitle" placeholder="Product title">
    <input type="number" id="pprice" placeholder="Product Price">
    <input type="text" id="pdesc" placeholder="Product Description">
    <button onclick="save()">Add/Update</button>
    <br><br>
    <hr><br>
    <table border="1">
        <thead>
            <tr>
                <th>Product ID</th>
                <th>Product Title</th>
                <th>Product Price</th>
                <th>Product Description</th>
                <th colspan="2">Actions</th>
            </tr>
        </thead>
        <tbody id="data"></tbody>
    </table>

    <script>
        const url="http://localhost:3000/products";
        var editId="";

        function load(){
            fetch(url)
            .then(res=>res.json())
            .then(d=>{
                var rows='';
                d.forEach(p=>{
                    rows += `
                    <tr>    <td>${p.productId}</td>
                            <td>${p.productTitle}</td>
                            <td>${p.productPrice}</td>
                            <td>${p.productDesc}</td>
                            <td><button onclick="del(${p.productId})">Delete</button></td>
                            <td><button onclick="edit('${p.productId}','${p.productTitle}','${p.productPrice}','${p.productDesc}')">Edit</button></td>
                    </tr>
                    `;
                })
                document.getElementById('data').innerHTML=rows;
            })   
        }
        load();
        function save(){
            if(editId===""){
                fetch(url+"/add",{
                    method:"POST",
                    headers:{'content-type':'application/json'},
                    body:JSON.stringify({
                        productId:pid.value,
                        productTitle:ptitle.value,
                        productPrice:pprice.value,
                        productDesc:pdesc.value
                    })
                })
                .then(()=>{
                    pid.value="";
                    ptitle.value="";
                    pprice.value="";
                    pdesc.value="";
                    load()
                });
            }
            else{
                fetch(url+"/"+editId,{
                    method:"PUT",
                    headers:{'content-type':'application/json'},
                    body:JSON.stringify({
                        productId:pid.value,
                        productTitle:ptitle.value,
                        productPrice:pprice.value,
                        productDesc:pdesc.value
                    })
                })
                .then(()=>{
                    document.getElementById('pid').disabled=false;
                    pid.value="";
                    ptitle.value="";
                    pprice.value="";
                    pdesc.value="";
                    load();
                    
                })
            }
        }
        function del(id){
            fetch(url+"/"+id,{method:"DELETE" })
            .then(()=>load());
        }
        function edit(id,t,p,d){
            editId=id;
            pid.value=id;
            document.getElementById('pid').disabled=true;
            ptitle.value=t;
            pprice.value=p;
            pdesc.value=d;
        }
    </script>

</body>
</html>
